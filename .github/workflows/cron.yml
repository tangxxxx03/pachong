name: HR News（三茅人力资源网净化版）

on:
  workflow_dispatch: {}
  schedule:
    # 每天北京时间 09:00 运行（UTC 01:00）
    - cron: "0 1 * * *"

permissions: read-all

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    env:
      # —— 脚本参数 ——（只使用关键词筛选，其他可保留不影响）
      HR_TZ: Asia/Shanghai
      HR_ONLY_TODAY: "1"
      HR_FILTER_KEYWORDS: "人力资源,社保,员工,用工,劳动,招聘,工资,缴费"
      HR_REQUIRE_ALL: "0"
      HR_MAX_ITEMS: "15"
      SRC_HRLOO_URLS: "https://www.hrloo.com/"

      # —— 钉钉 webhook（优先取 Secrets，未配时脚本会用代码里的默认值）——
      DINGTALK_BASEA: ${{ secrets.DINGTALK_BASEA }}
      DINGTALK_SECRETA: ${{ secrets.DINGTALK_SECRETA }}
      DINGTALK_KEYWORD: "早安资讯"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Sanity check (time & branch)
        run: |
          echo "UTC now: $(date -u)"
          echo "Asia/Shanghai now: $(TZ=Asia/Shanghai date)"
          echo "Default branch? $GITHUB_REF_NAME"

      - name: Run HRLoo-only（三茅人力资源网）
        run: |
          echo "执行 main.py"
          python main.py
