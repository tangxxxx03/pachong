name: HR News (三茅人力资源网专抓版)

on:
  workflow_dispatch: {}       # 可手动运行
  schedule:
    # 每天 23:30 UTC ≈ 北京时间次日 07:30
    - cron: "30 23 * * *"

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    env:
      # —— 抓取与过滤参数 ——
      HR_TZ: Asia/Shanghai
      HR_ONLY_TODAY: "1"                   # 仅抓当天
      HR_FILTER_KEYWORDS: "人力资源,社保,用工"
      HR_REQUIRE_ALL: "0"                  # 匹配任一关键词即可
      HR_MAX_ITEMS: "15"
      SRC_HRLOO_URLS: "https://www.hrloo.com/"

      # —— 使用 A 尾缀的钉钉密钥（与你 Secrets 中的一致）——
      DINGTALK_BASEA:   ${{ secrets.DINGTALK_BASEA }}
      DINGTALK_SECRETA: ${{ secrets.DINGTALK_SECRETA }}


      DINGTALK_KEYWORD: "HR资讯"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 urllib3 tzdata

      # 运行三茅专抓脚本（你的脚本名）
      - name: Run HRLoo-only (三茅人力资源网)
        run: |
          echo "当前目录："
          pwd
          echo "目录内容："
          ls -la
          echo "执行脚本：hr_news_crawler.py"
          python hr_news_crawler.py --limit 20
